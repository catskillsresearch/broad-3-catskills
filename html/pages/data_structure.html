<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Structure - Broad Institute IBD Challenge: Catskills Solution for Crunch 3</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/modal_styles.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</head>
<body>
    <header>
        <div class="logo-container">
            <h1>Broad Institute IBD Challenge: Catskills Solution for Crunch 3</h1>
        </div>
        <nav class="main-nav">
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="input_data.html">Input Data</a></li>
                <li><a href="data_structure.html" class="active">Data Structure</a></li>
                <li><a href="pipeline_flow.html">Pipeline Flow</a></li>
                <li><a href="process_flow.html">Process Flow</a></li>
                <li><a href="deepspot_architecture.html">DeepSpot Techniques</a></li>
                <li><a href="implementation.html">Implementation</a></li>
                <li><a href="visualizations.html">Visualizations</a></li>
                <li><a href="crunch_approaches.html">Integrated Approach</a></li>
                <li><a href="getting_started.html">Getting Started</a></li>
            </ul>
        </nav>
        <button class="mobile-menu-toggle">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>

    <div class="container">
        <aside class="sidebar">
            <div class="search-container">
                <input type="text" placeholder="Search documentation...">
                <button type="submit">Search</button>
            </div>
            <nav class="side-nav">
                <h3>On This Page</h3>
                <ul>
                    <li><a href="#overview">Overview</a></li>
                    <li><a href="#streamlined-structure">Streamlined Structure</a></li>
                    <li><a href="#directory-organization">Directory Organization</a></li>
                    <li><a href="#data-formats">Data Formats</a></li>
                    <li><a href="#processed-outputs">Processed Outputs</a></li>
                </ul>
            </nav>
        </aside>

        <main class="content">
            <div class="breadcrumbs">
                <span><a href="../index.html">Home</a></span>
                <span>Data Structure</span>
            </div>

            <section id="overview">
                <h2>Data Structure Overview</h2>
                <p>This page describes the streamlined data structure used in the Catskills Solution for Crunch 3. We've organized the data to clearly show the transformations from input to output, removing unused elements to simplify the pipeline.</p>
                
                <div class="info-box">
                    <h3>Key Principles</h3>
                    <p>Our data structure follows these key principles:</p>
                    <ul>
                        <li><strong>Simplicity</strong>: Only includes data elements that are actually used in the pipeline</li>
                        <li><strong>Organization</strong>: Groups related data types together</li>
                        <li><strong>Traceability</strong>: Makes data transformations clear and easy to follow</li>
                        <li><strong>Efficiency</strong>: Optimizes for the specific needs of our approach</li>
                    </ul>
                </div>
            </section>

            <section id="streamlined-structure">
                <h2>Streamlined Data Structure</h2>
                <p>The following diagram shows the complete data structure used in our solution. <strong>Click on the diagram to view a larger version.</strong></p>
                
                <div class="large-diagram-container">
                    <div class="mermaid">
flowchart TD
    %% Main Data Directories
    root["/"] --> data_dir["data/"]
    root --> output["output/"]
    
    %% Data Subdirectories
    data_dir --> UC9_I["UC9_I.zarr\n(spatial gene expression)"]
    data_dir --> gene_list["Crunch3_gene_list.csv"]
    data_dir --> scRNAseq["Crunch3_scRNAseq.h5ad"]
    data_dir --> HE_dysplasia["UC9_I-crunch3-HE-dysplasia-ROI.tif"]
    data_dir --> HE_label["UC9_I-crunch3-HE-label-stardist.tif"]
    data_dir --> HE["UC9_I-crunch3-HE.tif"]
    
    %% Output Subdirectories
    output --> output_data["data/"]
    output --> features["features/"]
    output --> models["models/"]
    output --> predictions["predictions/"]
    output --> evaluation["evaluation/"]
    
    %% Output Data Subdirectory
    output_data --> small_dataset["small_dataset/"]
    
    %% Small Dataset Files
    small_dataset --> cell_coordinates["cell_coordinates.npy"]
    small_dataset --> gene_expression["gene_expression.npy"]
    small_dataset --> gene_names["gene_names.npy"]
    small_dataset --> metadata["metadata.yaml"]
    small_dataset --> config_yaml["config.yaml"]
    small_dataset --> original_indices["original_indices.npy"]
    small_dataset --> quality_scores["quality_scores.npy"]
    small_dataset --> region_labels["region_labels.npy"]
    small_dataset --> test_indices["test_indices.npy"]
    small_dataset --> train_indices["train_indices.npy"]
    small_dataset --> val_indices["val_indices.npy"]
    
    %% Features Directory
    features --> image_patches["image_patches.npz"]
    features --> multilevel_features["multilevel_features.npz"]
    features --> training_data["training_data.npz"]
    
    %% Styling
    classDef inputData fill:#f9f9f9,stroke:#999,stroke-width:2px,color:#333,font-size:14px
    classDef processedData fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#2e7d32,font-size:14px
    
    class root,data_dir,UC9_I,gene_list,scRNAseq,HE_dysplasia,HE_label,HE inputData
    class output,output_data,features,models,predictions,evaluation,small_dataset processedData
    class cell_coordinates,gene_expression,gene_names,metadata,config_yaml,original_indices,quality_scores,region_labels,test_indices,train_indices,val_indices,image_patches,multilevel_features,training_data processedData
                    </div>
                </div>
                
                <p>Note that we've updated the diagram to reflect the actual structure of the pipeline outputs.</p>
            </section>

            <section id="directory-organization">
                <h2>Directory Organization</h2>
                <p>The data is organized into the following main directories:</p>
                
                <div class="comparison-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Directory</th>
                                <th>Contents</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>data/</code></td>
                                <td>Input data files</td>
                                <td>Contains the raw input data files provided for the challenge</td>
                            </tr>
                            <tr>
                                <td><code>output/</code></td>
                                <td>Pipeline outputs</td>
                                <td>All outputs generated by the pipeline, organized by type</td>
                            </tr>
                            <tr>
                                <td><code>output/data/</code></td>
                                <td>Processed data</td>
                                <td>Processed data files generated by the pipeline</td>
                            </tr>
                            <tr>
                                <td><code>output/features/</code></td>
                                <td>Extracted features</td>
                                <td>Features extracted from the input data</td>
                            </tr>
                            <tr>
                                <td><code>output/models/</code></td>
                                <td>Trained models</td>
                                <td>Trained model weights and configurations</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>Input Data Directory</h3>
                <p>The <code>data/</code> directory contains the raw input data files:</p>
                <ul>
                    <li><code>UC9_I.zarr</code>: Spatial gene expression data in zarr format</li>
                    <li><code>Crunch3_gene_list.csv</code>: List of genes for analysis</li>
                    <li><code>Crunch3_scRNAseq.h5ad</code>: Single-cell RNA-seq data</li>
                    <li><code>UC9_I-crunch3-HE-dysplasia-ROI.tif</code>: H&E image with dysplasia regions</li>
                    <li><code>UC9_I-crunch3-HE-label-stardist.tif</code>: Nucleus segmentation masks</li>
                    <li><code>UC9_I-crunch3-HE.tif</code>: H&E pathology image</li>
                </ul>
                
                <div class="note-box">
                    <h4>Note on Data Organization</h4>
                    <p>The actual data organization differs from the conceptual organization described in earlier documentation. This document reflects the actual file structure as implemented in the pipeline.</p>
                </div>
            </section>

            <section id="data-formats">
                <h2>Data Formats</h2>
                <p>The data is stored in various formats, each optimized for its specific content:</p>
                
                <div class="comparison-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Data Type</th>
                                <th>Format</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>H&E Images</td>
                                <td>TIFF</td>
                                <td>High-resolution tissue images with multiple channels</td>
                            </tr>
                            <tr>
                                <td>Nucleus Masks</td>
                                <td>TIFF</td>
                                <td>Binary masks identifying individual nuclei</td>
                            </tr>
                            <tr>
                                <td>Spatial Transcriptomics</td>
                                <td>Zarr</td>
                                <td>Chunked, compressed array format for efficient access</td>
                            </tr>
                            <tr>
                                <td>scRNA-seq Data</td>
                                <td>H5AD</td>
                                <td>AnnData format for single-cell data with annotations</td>
                            </tr>
                            <tr>
                                <td>Metadata</td>
                                <td>CSV</td>
                                <td>Tabular data with cell and region annotations</td>
                            </tr>
                            <tr>
                                <td>Extracted Features</td>
                                <td>NPY/NPZ</td>
                                <td>NumPy array format for efficient storage of numerical data</td>
                            </tr>
                            <tr>
                                <td>Configuration</td>
                                <td>YAML</td>
                                <td>Human-readable configuration files</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="processed-outputs">
                <h2>Processed Outputs</h2>
                <p>The <code>output/</code> directory contains all outputs generated by the pipeline, organized by type:</p>
                
                <h3>Small Dataset Structure</h3>
                <p>The <code>output/data/small_dataset/</code> directory contains the following files:</p>
                
                <div class="comparison-table">
                    <table>
                        <thead>
                            <tr>
                                <th>File</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>cell_coordinates.npy</code></td>
                                <td>Spatial coordinates of cells in the small dataset</td>
                            </tr>
                            <tr>
                                <td><code>gene_expression.npy</code></td>
                                <td>Gene expression matrix for the small dataset</td>
                            </tr>
                            <tr>
                                <td><code>gene_names.npy</code></td>
                                <td>Names of genes in the expression matrix</td>
                            </tr>
                            <tr>
                                <td><code>metadata.yaml</code></td>
                                <td>Metadata about the small dataset</td>
                            </tr>
                            <tr>
                                <td><code>config.yaml</code></td>
                                <td>Configuration used to generate the small dataset</td>
                            </tr>
                            <tr>
                                <td><code>original_indices.npy</code></td>
                                <td>Indices mapping small dataset cells to original dataset</td>
                            </tr>
                            <tr>
                                <td><code>quality_scores.npy</code></td>
                                <td>Quality scores for cells in the small dataset</td>
                            </tr>
                            <tr>
                                <td><code>region_labels.npy</code></td>
                                <td>Region labels for cells in the small dataset</td>
                            </tr>
                            <tr>
                                <td><code>test_indices.npy</code></td>
                                <td>Indices for test set cells</td>
                            </tr>
                            <tr>
                                <td><code>train_indices.npy</code></td>
                                <td>Indices for training set cells</td>
                            </tr>
                            <tr>
                                <td><code>val_indices.npy</code></td>
                                <td>Indices for validation set cells</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>Features Directory</h3>
                <p>The <code>output/features/</code> directory contains the following files:</p>
                
                <div class="comparison-table">
                    <table>
                        <thead>
                            <tr>
                                <th>File</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>image_patches.npz</code></td>
                                <td>Image patches extracted around each cell</td>
                            </tr>
                            <tr>
                                <td><code>multilevel_features.npz</code></td>
                                <td>Multi-level features extracted from image patches</td>
                            </tr>
                            <tr>
                                <td><code>training_data.npz</code></td>
                                <td>Combined features and gene expression for model training</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <p>These outputs provide a complete record of the pipeline execution and results, allowing for analysis and interpretation of the findings.</p>
            </section>

            <div class="page-navigation">
                <a href="input_data.html" class="prev-page">Previous: Input Data</a>
                <a href="pipeline_flow.html" class="next-page">Next: Pipeline Flow</a>
            </div>
        </main>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Broad Institute IBD Challenge: Catskills Solution for Crunch 3</h3>
                <p>Comprehensive documentation of our approach to identifying gene markers that distinguish dysplastic from non-dysplastic tissue regions.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="input_data.html">Input Data</a></li>
                    <li><a href="data_structure.html">Data Structure</a></li>
                    <li><a href="pipeline_flow.html">Pipeline Flow</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Resources</h3>
                <ul>
                    <li><a href="implementation.html">Implementation</a></li>
                    <li><a href="visualizations.html">Visualizations</a></li>
                    <li><a href="crunch_approaches.html">Integrated Approach</a></li>
                    <li><a href="getting_started.html">Getting Started</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Catskills Solution for Broad Institute IBD Challenge</p>
        </div>
    </footer>

    <script src="../js/scripts.js"></script>
    <script>
        // Initialize Mermaid for diagrams
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            },
            securityLevel: 'loose'
        });
        
        // Initialize Highlight.js for code syntax highlighting
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    </script>
</body>
</html>
